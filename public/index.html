<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Intervention AI Chatbot</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth.js"></script>
    <style>
        .message-container {
            height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="text-2xl mr-3">üö®</div>
                    <h1 class="text-xl font-bold text-gray-800">Crisis Intervention</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="goBack()" class="text-gray-600 hover:text-gray-800 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back
                    </button>
                    <a href="home.html" class="text-gray-600 hover:text-gray-800 px-3 py-2 rounded-md text-sm font-medium">Home</a>
                    <a href="dashboard.html" class="text-gray-600 hover:text-gray-800 px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
                    <a href="resources.html" class="text-gray-600 hover:text-gray-800 px-3 py-2 rounded-md text-sm font-medium">Resources</a>
                    <button onclick="auth.logout()" class="text-red-600 hover:text-red-800 px-3 py-2 rounded-md text-sm font-medium">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Chat Container -->
    <div class="flex items-center justify-center p-4 flex-1">
        <div class="w-full max-w-4xl h-[600px] bg-white rounded-2xl shadow-2xl flex flex-col">
        <!-- Header -->
        <div class="bg-gradient-to-r from-red-600 to-pink-600 text-white p-6 rounded-t-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <button onclick="goBack()" class="mr-4 text-white hover:text-red-100 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <div>
                        <h1 class="text-2xl font-bold">üö® Crisis Intervention Support</h1>
                        <p class="text-red-100">24/7 AI-powered crisis intervention and support</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div id="status-indicator" class="w-3 h-3 rounded-full bg-red-400"></div>
                    <span id="status-text" class="text-sm">Disconnected</span>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div id="messages" class="flex-1 overflow-y-auto p-6 space-y-4 message-container">
            <div class="flex justify-start">
                <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-2xl bg-gray-100 text-gray-800">
                    <p class="text-sm">Hello! I'm here to help you. This is a crisis intervention support system. How are you feeling today?</p>
                    <p class="text-xs opacity-70 mt-1" id="welcome-time"></p>
                </div>
            </div>
        </div>

        <!-- Input -->
        <div class="p-6 border-t border-gray-200">
            <div class="flex space-x-4">
                <input
                    type="text"
                    id="messageInput"
                    placeholder="Type your message here..."
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    disabled
                />
                <button
                    id="sendButton"
                    class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    disabled
                >
                    Send
                </button>
            </div>
            
            <!-- Emergency Resources -->
            <div class="mt-4 p-4 bg-red-50 rounded-xl border border-red-200">
                <h3 class="font-semibold text-red-800 mb-2">üö® Emergency Resources</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                    <div class="flex items-center space-x-2">
                        <span class="text-red-600">üìû</span>
                        <span>National Suicide Prevention: <strong>988</strong></span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-red-600">üí¨</span>
                        <span>Crisis Text Line: <strong>741741</strong></span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-red-600">üö®</span>
                        <span>Emergency Services: <strong>911</strong></span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-red-600">üè†</span>
                        <span>Domestic Violence: <strong>800-799-7233</strong></span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (!auth.isLoggedIn) {
                alert('Please login to access the chat.');
                window.location.href = 'login.html';
                return;
            }
            
            // Enable chat if user is logged in
            document.getElementById('messageInput').disabled = false;
            document.getElementById('sendButton').disabled = false;
            
            // Set welcome message time
            document.getElementById('welcome-time').textContent = new Date().toLocaleTimeString();
            
            // Initialize chat functionality
            initializeChat();
        });

        function goBack() {
            window.history.back();
        }

        function initializeChat() {
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const messagesContainer = document.getElementById('messages');
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');

            // Simulate connection
            setTimeout(() => {
                statusIndicator.className = 'w-3 h-3 rounded-full bg-green-400';
                statusText.textContent = 'Connected';
            }, 1000);

            function addMessage(content, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
                
                const messageBubble = document.createElement('div');
                messageBubble.className = `max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${
                    isUser ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'
                }`;
                
                const messageText = document.createElement('p');
                messageText.className = 'text-sm';
                messageText.textContent = content;
                
                const messageTime = document.createElement('p');
                messageTime.className = 'text-xs opacity-70 mt-1';
                messageTime.textContent = new Date().toLocaleTimeString();
                
                messageBubble.appendChild(messageText);
                messageBubble.appendChild(messageTime);
                messageDiv.appendChild(messageBubble);
                messagesContainer.appendChild(messageDiv);
                
                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function sendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;
                
                // Add user message
                addMessage(message, true);
                messageInput.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    const responses = [
                        "I hear you, and I want you to know that your feelings are valid. Can you tell me more about what's going on?",
                        "Thank you for sharing that with me. It sounds like you're going through a really difficult time. What would be most helpful for you right now?",
                        "I'm here to listen and support you. Have you considered talking to a professional counselor or therapist?",
                        "Your safety is the most important thing. If you're having thoughts of harming yourself, please call 988 immediately.",
                        "It takes courage to reach out for help. What kind of support do you think would be most beneficial for you?"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, false);
                }, 1000 + Math.random() * 2000);
            }

            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }
    </script>
</body>
</html> 